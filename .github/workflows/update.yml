- name: Check and Generate Lists
        run: |
          check_proxies() {
            local type=$1; local input=$2; local output=$3; local prefix=$4
            echo "Starting check for $type..."
            touch "$output"
            [ ! -s "$input" ] && return
            cat "$input" | xargs -P 100 -I {} sh -c "
              proxy='{}'
              if curl --$type-hostname \$proxy -sI --connect-timeout 8 --max-time 15 https://www.google.com > /dev/null 2>&1; then
                echo '$prefix'\$proxy >> $output
              fi
            " || true
          }

          # --- SOCKS5 (Добавил еще 5 источников) ---
          urls_s5=(
            "https://raw.githubusercontent.com/ClearProxy/checked-proxy-list/refs/heads/main/socks5/raw/all.txt"
            "https://raw.githubusercontent.com/elliottophellia/proxylist/refs/heads/master/results/socks5/global/socks5_checked.txt"
            "https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/socks5.txt"
            "https://raw.githubusercontent.com/MuRongPIG/Proxy-Master/main/socks5.txt"
            "https://raw.githubusercontent.com/Zaeem20/free-proxy-list/master/socks5.txt"
            "https://api.proxyscrape.com/v2/?request=displayproxies&protocol=socks5"
            "https://raw.githubusercontent.com/officialputuid/Proxy-List/master/socks5.txt"
            "https://raw.githubusercontent.com/ErcinDedeoglu/proxies/main/proxies/socks5.txt"
          )
          for url in "${urls_s5[@]}"; do curl -L -s "$url" >> s5_raw.txt || true; done
          sed -E 's/^(socks5:\/\/|socks4:\/\/|http:\/\/|https:\/\/)//I' s5_raw.txt | tr -d '\r' | sort -u | grep -E '^[0-9.]+:[0-9]+$' | head -n 3000 > s5_clean.txt
          check_proxies "socks5" "s5_clean.txt" "socks5.txt" "socks5://"

          # --- HTTP (Тоже добавил новые) ---
          urls_http=(
            "https://raw.githubusercontent.com/ClearProxy/checked-proxy-list/refs/heads/main/http/raw/all.txt"
            "https://raw.githubusercontent.com/elliottophellia/proxylist/refs/heads/master/results/http/global/http_checked.txt"
            "https://raw.githubusercontent.com/TheSpeedX/SOCKS-List/master/http.txt"
            "https://api.proxyscrape.com/v2/?request=displayproxies&protocol=http"
            "https://raw.githubusercontent.com/roosterkid/openproxylist/main/HTTPS_RAW.txt"
            "https://raw.githubusercontent.com/officialputuid/Proxy-List/master/http.txt"
          )
          for url in "${urls_http[@]}"; do curl -L -s "$url" >> http_raw.txt || true; done
          sed -E 's/^(socks5:\/\/|socks4:\/\/|http:\/\/|https:\/\/)//I' http_raw.txt | tr -d '\r' | sort -u | grep -E '^[0-9.]+:[0-9]+$' | head -n 3000 > http_clean.txt
          
          # Чекер для HTTP
          cat http_clean.txt | xargs -P 100 -I {} sh -c "
            proxy='{}'
            if curl -x http://\$proxy -sI --connect-timeout 8 --max-time 15 https://www.google.com > /dev/null 2>&1; then
              echo 'http://'\$proxy >> http.txt
            fi
          " || true
